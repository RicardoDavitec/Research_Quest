### ResearchQuest API Tests
### Configuração de variáveis
@baseUrl = http://localhost:3000
@accessToken = 

### ============================================
### AUTENTICAÇÃO
### ============================================

### 1. SignUp - Criar primeiro usuário (Coordenador)
POST {{baseUrl}}/auth/signup
Content-Type: application/json

{
  "email": "coordenador@teste.com",
  "password": "Senha@123",
  "cpf": "123.456.789-00",
  "name": "Dr. João Coordenador",
  "phone": "(11) 98765-4321",
  "role": "COORDENADOR_PROJETO",
  "primaryInstitutionId": "CRIAR_INSTITUICAO_PRIMEIRO",
  "academicTitle": "Doutor em Ciências da Saúde",
  "lattesNumber": "1234567890123456",
  "orcidId": "0000-0002-1234-5678",
  "specialization": "Epidemiologia, Saúde Pública"
}

### 2. SignIn - Fazer login
POST {{baseUrl}}/auth/signin
Content-Type: application/json

{
  "email": "coordenador@teste.com",
  "password": "Senha@123"
}

### 3. Refresh Token
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "SEU_REFRESH_TOKEN_AQUI"
}

### 4. Logout
POST {{baseUrl}}/auth/logout
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "refreshToken": "SEU_REFRESH_TOKEN_AQUI"
}

### ============================================
### INSTITUIÇÕES
### ============================================

### 5. Criar Instituição
POST {{baseUrl}}/institutions
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "cnpj": "12.345.678/0001-90",
  "name": "Universidade Federal de Teste",
  "type": "ACADEMICA",
  "coordinatorId": "ID_DO_RESEARCHER_DO_USUARIO_LOGADO",
  "email": "contato@uft.edu.br",
  "phone": "(11) 3333-4444",
  "website": "https://www.uft.edu.br",
  "address": "Rua das Flores, 123",
  "city": "São Paulo",
  "state": "SP",
  "zipCode": "01234-567",
  "country": "Brasil",
  "description": "Instituição de ensino superior focada em pesquisa científica",
  "foundedAt": "1960-01-01T00:00:00.000Z"
}

### 6. Listar Instituições
GET {{baseUrl}}/institutions
Authorization: Bearer {{accessToken}}

### 7. Listar Instituições com Filtros
GET {{baseUrl}}/institutions?type=ACADEMICA&state=SP&search=Federal
Authorization: Bearer {{accessToken}}

### 8. Buscar Instituição por ID
GET {{baseUrl}}/institutions/SEU_INSTITUTION_ID
Authorization: Bearer {{accessToken}}

### 9. Listar Pesquisadores da Instituição (Primários)
GET {{baseUrl}}/institutions/SEU_INSTITUTION_ID/researchers?primary=true
Authorization: Bearer {{accessToken}}

### 10. Obter Estatísticas da Instituição
GET {{baseUrl}}/institutions/SEU_INSTITUTION_ID/statistics
Authorization: Bearer {{accessToken}}

### 11. Atualizar Instituição
PATCH {{baseUrl}}/institutions/SEU_INSTITUTION_ID
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "phone": "(11) 3333-5555",
  "description": "Instituição atualizada com nova descrição"
}

### 12. Deletar Instituição
DELETE {{baseUrl}}/institutions/SEU_INSTITUTION_ID
Authorization: Bearer {{accessToken}}

### ============================================
### QUESTÕES
### ============================================

### 13. Criar Questão
POST {{baseUrl}}/questions
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "text": "Qual é a sua idade?",
  "type": "NUMERICA",
  "category": "DEMOGRAFICA",
  "scope": "LOCAL",
  "isRequired": true,
  "minValue": 0,
  "maxValue": 120,
  "helpText": "Informe sua idade em anos completos",
  "objective": "Coletar dados demográficos dos participantes",
  "targetAudience": "Todos os participantes da pesquisa",
  "origin": "MANUAL"
}

### 14. Criar Questão de Múltipla Escolha
POST {{baseUrl}}/questions
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "text": "Qual o seu nível de escolaridade?",
  "type": "MULTIPLA_ESCOLHA",
  "category": "DEMOGRAFICA",
  "scope": "NACIONAL",
  "isRequired": true,
  "options": {
    "choices": [
      "Ensino Fundamental Incompleto",
      "Ensino Fundamental Completo",
      "Ensino Médio Incompleto",
      "Ensino Médio Completo",
      "Ensino Superior Incompleto",
      "Ensino Superior Completo",
      "Pós-graduação"
    ]
  },
  "objective": "Identificar perfil educacional dos participantes",
  "origin": "MANUAL"
}

### 15. Criar Questão Escala Likert
POST {{baseUrl}}/questions
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "text": "Como você avalia a qualidade do atendimento?",
  "type": "ESCALA_LIKERT",
  "category": "COMPORTAMENTAL",
  "scope": "LOCAL",
  "isRequired": true,
  "likertMin": 1,
  "likertMax": 5,
  "likertLabels": {
    "1": "Muito insatisfeito",
    "2": "Insatisfeito",
    "3": "Neutro",
    "4": "Satisfeito",
    "5": "Muito satisfeito"
  },
  "objective": "Medir satisfação com serviços",
  "origin": "MANUAL"
}

### 16. Importar Questões em Lote
POST {{baseUrl}}/questions/import
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "questions": [
    {
      "text": "Qual é o seu nome completo?",
      "type": "ABERTA",
      "category": "DEMOGRAFICA",
      "scope": "LOCAL",
      "isRequired": true
    },
    {
      "text": "Você tem alguma doença crônica?",
      "type": "SIM_NAO",
      "category": "CLINICA",
      "scope": "LOCAL",
      "isRequired": true
    },
    {
      "text": "Data de nascimento",
      "type": "DATA",
      "category": "DEMOGRAFICA",
      "scope": "LOCAL",
      "isRequired": true
    }
  ],
  "defaultOrigin": "IMPORTED_BATCH",
  "researchGroupId": null
}

### 17. Listar Questões
GET {{baseUrl}}/questions
Authorization: Bearer {{accessToken}}

### 18. Listar Questões com Filtros
GET {{baseUrl}}/questions?type=NUMERICA&category=DEMOGRAFICA&scope=LOCAL
Authorization: Bearer {{accessToken}}

### 19. Buscar Questões por Texto
GET {{baseUrl}}/questions?search=idade
Authorization: Bearer {{accessToken}}

### 20. Buscar Questão por ID
GET {{baseUrl}}/questions/SEU_QUESTION_ID
Authorization: Bearer {{accessToken}}

### 21. Buscar Questões Similares (pgVector - quando instalado)
GET {{baseUrl}}/questions/SEU_QUESTION_ID/similar
Authorization: Bearer {{accessToken}}

### 22. Obter Estatísticas de Questões (apenas coordenadores)
GET {{baseUrl}}/questions/statistics
Authorization: Bearer {{accessToken}}

### 23. Atualizar Questão (cria nova versão)
PATCH {{baseUrl}}/questions/SEU_QUESTION_ID
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "text": "Qual é a sua idade atual?",
  "helpText": "Informe sua idade em anos completos no momento da pesquisa"
}

### 24. Deletar Questão
DELETE {{baseUrl}}/questions/SEU_QUESTION_ID
Authorization: Bearer {{accessToken}}

### ============================================
### UPLOAD DE ARQUIVOS
### ============================================

### 25. Download Template Excel
GET {{baseUrl}}/questions/templates/excel
Authorization: Bearer {{accessToken}}

### 26. Download Template CSV
GET {{baseUrl}}/questions/templates/csv
Authorization: Bearer {{accessToken}}

### 27. Upload Excel com Questões
# Nota: Use Thunder Client ou Postman para testar upload de arquivos
# No Thunder Client:
# 1. Selecione método POST
# 2. URL: http://localhost:3000/questions/upload/excel
# 3. Aba "Body" > "Form"
# 4. Adicione campo "file" tipo "File" e selecione arquivo .xlsx
# 5. Adicione campo "defaultOrigin" tipo "Text" com valor "EXCEL_IMPORT" (opcional)
# 6. Adicione campo "researchGroupId" tipo "Text" com UUID (opcional)
# 7. Aba "Headers" > Adicione "Authorization: Bearer SEU_TOKEN"
POST {{baseUrl}}/questions/upload/excel
Authorization: Bearer {{accessToken}}
Content-Type: multipart/form-data

# Body (form-data):
# file: [selecionar arquivo .xlsx]
# defaultOrigin: EXCEL_IMPORT
# researchGroupId: uuid-do-grupo (opcional)

### 28. Upload CSV com Questões
POST {{baseUrl}}/questions/upload/csv
Authorization: Bearer {{accessToken}}
Content-Type: multipart/form-data

# Body (form-data):
# file: [selecionar arquivo .csv]
# defaultOrigin: CSV_IMPORT
# researchGroupId: uuid-do-grupo (opcional)

### ============================================
### USUÁRIOS
### ============================================

### 29. Listar Usuários (apenas coordenadores)
GET {{baseUrl}}/users
Authorization: Bearer {{accessToken}}

### 30. Buscar Usuário por ID
GET {{baseUrl}}/users/SEU_USER_ID
Authorization: Bearer {{accessToken}}

### 31. Atualizar Usuário
PATCH {{baseUrl}}/users/SEU_USER_ID
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "phone": "(11) 99999-8888"
}

### 32. Deletar Usuário
DELETE {{baseUrl}}/users/SEU_USER_ID
Authorization: Bearer {{accessToken}}

### ============================================
### TESTES DE VALIDAÇÃO
### ============================================

### 33. Teste: Criar instituição com CNPJ inválido (deve falhar)
POST {{baseUrl}}/institutions
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "cnpj": "12345678000190",
  "name": "Teste CNPJ Inválido",
  "type": "ACADEMICA",
  "coordinatorId": "ID_VALIDO"
}

### 34. Teste: Criar questão sem autenticação (deve falhar 401)
POST {{baseUrl}}/questions
Content-Type: application/json

{
  "text": "Teste sem auth",
  "type": "ABERTA"
}

### 35. Teste: Criar instituição com role inadequado (deve falhar 403)
### (Use token de um usuário ALUNO)
POST {{baseUrl}}/institutions
Authorization: Bearer TOKEN_DE_ALUNO
Content-Type: application/json

{
  "cnpj": "98.765.432/0001-00",
  "name": "Teste Role",
  "type": "ACADEMICA",
  "coordinatorId": "ID_VALIDO"
}

### ============================================
### PROJETOS (PROJECTS)
### ============================================

### 36. Criar Projeto
POST {{baseUrl}}/projects
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "title": "Pesquisa sobre Qualidade de Vida em Comunidades Rurais",
  "description": "Este projeto visa investigar os fatores que influenciam a qualidade de vida nas comunidades rurais da região, focando em aspectos socioeconômicos, acesso a serviços de saúde e bem-estar geral.",
  "status": "EM_ANDAMENTO",
  "cepProtocol": "CAAE: 12345678.9.0000.5555",
  "researchArea": "Saúde Pública",
  "keywords": ["qualidade de vida", "saúde pública", "zona rural", "determinantes sociais"],
  "fundingAgency": "CNPq - Conselho Nacional de Desenvolvimento Científico e Tecnológico",
  "fundingAmount": 50000.00,
  "startDate": "2025-01-15",
  "endDate": "2026-12-31",
  "methodology": "Estudo observacional transversal com coleta de dados primários através de questionários estruturados e entrevistas semiestruturadas. A amostra será composta por 500 participantes de 10 comunidades rurais.",
  "objectives": "Objetivo Geral: Avaliar a qualidade de vida nas comunidades rurais.\n\nObjetivos Específicos:\n1) Identificar os principais determinantes sociais da saúde\n2) Analisar o acesso aos serviços de saúde\n3) Avaliar indicadores de bem-estar subjetivo\n4) Propor intervenções baseadas em evidências",
  "schedule": "Fase 1 (Jan-Mar 2025): Revisão bibliográfica e preparação\nFase 2 (Abr-Jun 2025): Coleta de dados piloto\nFase 3 (Jul-Set 2025): Coleta de dados principal\nFase 4 (Out-Dez 2025): Análise de dados\nFase 5 (Jan-Jun 2026): Redação de artigos e relatório final",
  "institutionId": "ID_DA_INSTITUICAO",
  "coordinatorIds": ["ID_DO_PESQUISADOR_COORDENADOR"]
}

### 37. Listar Projetos
GET {{baseUrl}}/projects
Authorization: Bearer {{accessToken}}

### 38. Listar Projetos com Filtros
GET {{baseUrl}}/projects?status=EM_ANDAMENTO&search=saúde
Authorization: Bearer {{accessToken}}

### 39. Buscar Projeto por ID
GET {{baseUrl}}/projects/ID_DO_PROJETO
Authorization: Bearer {{accessToken}}

### 40. Atualizar Projeto
PATCH {{baseUrl}}/projects/ID_DO_PROJETO
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "status": "CONCLUIDO",
  "description": "Projeto concluído com sucesso. Resultados publicados em revista científica."
}

### 41. Adicionar Coordenador ao Projeto
POST {{baseUrl}}/projects/ID_DO_PROJETO/coordinators/ID_DO_PESQUISADOR
Authorization: Bearer {{accessToken}}

### 42. Remover Coordenador do Projeto
DELETE {{baseUrl}}/projects/ID_DO_PROJETO/coordinators/ID_DO_PESQUISADOR
Authorization: Bearer {{accessToken}}

### 43. Adicionar Membro ao Projeto
POST {{baseUrl}}/projects/ID_DO_PROJETO/members
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "researcherId": "ID_DO_PESQUISADOR",
  "role": "PESQUISADOR"
}

### 44. Listar Membros do Projeto
GET {{baseUrl}}/projects/ID_DO_PROJETO/members
Authorization: Bearer {{accessToken}}

### 45. Remover Membro do Projeto
DELETE {{baseUrl}}/projects/ID_DO_PROJETO/members/ID_DO_PESQUISADOR
Authorization: Bearer {{accessToken}}

### 46. Obter Estatísticas do Projeto
GET {{baseUrl}}/projects/ID_DO_PROJETO/statistics
Authorization: Bearer {{accessToken}}

### 47. Deletar Projeto
DELETE {{baseUrl}}/projects/ID_DO_PROJETO
Authorization: Bearer {{accessToken}}

### ============================================
### GRUPOS DE PESQUISA (RESEARCH GROUPS)
### ============================================

### 48. Criar Grupo de Pesquisa
POST {{baseUrl}}/research-groups
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Grupo de Estudo sobre Qualidade de Vida",
  "description": "Este grupo foca em pesquisas relacionadas à qualidade de vida em comunidades urbanas e rurais, investigando fatores socioeconômicos, acesso a serviços e bem-estar.",
  "projectId": "ID_DO_PROJETO",
  "coordinatorId": "ID_DO_PESQUISADOR_COORDENADOR"
}

### 49. Listar Grupos de Pesquisa
GET {{baseUrl}}/research-groups
Authorization: Bearer {{accessToken}}

### 50. Listar Grupos com Filtros
GET {{baseUrl}}/research-groups?projectId=ID_DO_PROJETO&search=qualidade
Authorization: Bearer {{accessToken}}

### 51. Listar Grupos de um Projeto Específico
GET {{baseUrl}}/research-groups/project/ID_DO_PROJETO
Authorization: Bearer {{accessToken}}

### 52. Buscar Grupo por ID
GET {{baseUrl}}/research-groups/ID_DO_GRUPO
Authorization: Bearer {{accessToken}}

### 53. Atualizar Grupo
PATCH {{baseUrl}}/research-groups/ID_DO_GRUPO
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Grupo de Pesquisa em Saúde Coletiva",
  "description": "Descrição atualizada do grupo com novo foco de pesquisa."
}

### 54. Adicionar Membro ao Grupo
POST {{baseUrl}}/research-groups/ID_DO_GRUPO/members
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "researcherId": "ID_DO_PESQUISADOR",
  "role": "PESQUISADOR"
}

### 55. Listar Membros do Grupo
GET {{baseUrl}}/research-groups/ID_DO_GRUPO/members
Authorization: Bearer {{accessToken}}

### 56. Remover Membro do Grupo
DELETE {{baseUrl}}/research-groups/ID_DO_GRUPO/members/ID_DO_PESQUISADOR
Authorization: Bearer {{accessToken}}

### 57. Obter Estatísticas do Grupo
GET {{baseUrl}}/research-groups/ID_DO_GRUPO/statistics
Authorization: Bearer {{accessToken}}

### 58. Deletar Grupo de Pesquisa
DELETE {{baseUrl}}/research-groups/ID_DO_GRUPO
Authorization: Bearer {{accessToken}}

### ============================================
### NOTAS
### ============================================
# 1. Substitua {{accessToken}} pelo token JWT retornado no login
# 2. Substitua IDs de exemplo pelos IDs reais retornados nas respostas
# 3. Para criar o primeiro usuário, você precisa criar uma instituição manualmente no banco primeiro
#    OU ajustar o fluxo para permitir criação de instituição antes de ter pesquisador
# 4. Endpoints protegidos por roles:
#    - Criar/Atualizar/Deletar Instituições: COORDENADOR_GRUPO, COORDENADOR_PROJETO, DOCENTE
#    - Estatísticas: COORDENADOR_GRUPO, COORDENADOR_PROJETO, DOCENTE
#    - Listar usuários: COORDENADOR_GRUPO, COORDENADOR_PROJETO, DOCENTE
# 5. Use ferramentas como Thunder Client, REST Client (VS Code) ou Postman para executar
